<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CORS | What&#39;s Behind</title>
<meta name="keywords" content="">
<meta name="description" content="What&rsquo;s CORS CORS is a mechanism to stop you from accessing resource in one origin from another origin. For example, there is an image img.jpg from origin images.com, if you don&rsquo;t have CORS set properly, you can&rsquo;t access the img.jpg from other origins like yourOrigin.com.
Why needs CORS CORS is mainly for security usage. Image that your browser stores credential cookies of domain bank.com which is the website of you bank account, and a hacking website hacking.">
<meta name="author" content="">
<link rel="canonical" href="https://whatsBehind.github.io/programming/web/glossary/cors/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://whatsBehind.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://whatsBehind.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://whatsBehind.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://whatsBehind.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://whatsBehind.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="CORS" />
<meta property="og:description" content="What&rsquo;s CORS CORS is a mechanism to stop you from accessing resource in one origin from another origin. For example, there is an image img.jpg from origin images.com, if you don&rsquo;t have CORS set properly, you can&rsquo;t access the img.jpg from other origins like yourOrigin.com.
Why needs CORS CORS is mainly for security usage. Image that your browser stores credential cookies of domain bank.com which is the website of you bank account, and a hacking website hacking." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://whatsBehind.github.io/programming/web/glossary/cors/" /><meta property="article:section" content="programming" />
<meta property="article:published_time" content="2023-10-30T08:44:30-07:00" />
<meta property="article:modified_time" content="2023-10-30T08:44:30-07:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CORS"/>
<meta name="twitter:description" content="What&rsquo;s CORS CORS is a mechanism to stop you from accessing resource in one origin from another origin. For example, there is an image img.jpg from origin images.com, if you don&rsquo;t have CORS set properly, you can&rsquo;t access the img.jpg from other origins like yourOrigin.com.
Why needs CORS CORS is mainly for security usage. Image that your browser stores credential cookies of domain bank.com which is the website of you bank account, and a hacking website hacking."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Programmings",
      "item": "https://whatsBehind.github.io/programming/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CORS",
      "item": "https://whatsBehind.github.io/programming/web/glossary/cors/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CORS",
  "name": "CORS",
  "description": "What\u0026rsquo;s CORS CORS is a mechanism to stop you from accessing resource in one origin from another origin. For example, there is an image img.jpg from origin images.com, if you don\u0026rsquo;t have CORS set properly, you can\u0026rsquo;t access the img.jpg from other origins like yourOrigin.com.\nWhy needs CORS CORS is mainly for security usage. Image that your browser stores credential cookies of domain bank.com which is the website of you bank account, and a hacking website hacking.",
  "keywords": [
    
  ],
  "articleBody": "What’s CORS CORS is a mechanism to stop you from accessing resource in one origin from another origin. For example, there is an image img.jpg from origin images.com, if you don’t have CORS set properly, you can’t access the img.jpg from other origins like yourOrigin.com.\nWhy needs CORS CORS is mainly for security usage. Image that your browser stores credential cookies of domain bank.com which is the website of you bank account, and a hacking website hacking.com want to access your bank information and make a transaction from your bank. If without CORS, the javascript script from hacking.com is able to get the cookies under domain bank.com and make requests to bank.com. CORS can protect your website from malicious requests\nAccess-Control-Allow-Origin Header Issue Demonstration Start a local host\nconst express = require(\"express\"); const app = express(); app.get('/', (req, res) =\u003e { res.json({ name: \"Hello\", value: \"World\"}) }); app.listen(3000); In your browser, navigate to http://localhost:3000. Open console and make a GET request to http://localhost:3000\nfetch(\"http://localhost:3000\").then((req) =\u003e req.json()).then(console.log); You will receive a successful response\n{name: 'Hello', value: 'World'} You didn’t see any CORS issues, cause you were making request from http://localhost:3000 to same origin.\nOpen a new tab in your browser, navigate to www.google.com, and make a same request. You will see error like:\nAccess to fetch at 'http://localhost:3000/' from origin 'https://www.google.com' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled. Solution Add www.google.com in allowed origins in your CORS config\nconst express = require(\"express\"); const app = express(); const cors = require(\"cors\"); app.use(cors({ origin: \"https://www.google.com\" })); app.get('/', (req, res) =\u003e { res.json({ name: \"Hello\", value: \"World\"}) }); app.listen(3000); Make a same request again to local host, and the error is gone and you will see response printed in console:\n{name: 'Hello', value: 'World'} Access-Control-Allow-Methods Header Problem Demonstration To demonstration the problem with Access-Control-Allow-Methods header\nI add GET and POST as allowed methods in CORS config, which limits that clients can only use GET or POST methods in their requests to the server Also, I changed the method provided by the server from GET to PUT app.use(cors({ origin: \"https://www.google.com\", methods: [\"GET\", \"POST\"], })); app.put('/', (req, res) =\u003e { res.json({ name: \"Hello\", value: \"World\"}) }); Then let’s make request in the console under www.google.com domain\nfetch(\"http://localhost:3000\", {method: \"PUT\"}).then((req) =\u003e req.json()).then(console.log); We will see error:\nwww.google.com/:1 Access to fetch at 'http://localhost:3000/' from origin 'https://www.google.com' has been blocked by CORS policy: Method PUT is not allowed by Access-Control-Allow-Methods in preflight response. Solution Add PUT in allowed methods\napp.use(cors({ origin: \"https://www.google.com\", methods: [\"GET\", \"POST\", \"PUT\"], })); Make the same request from www.google.com again, and this time the error was gone and we receive correct response.\n{name: 'Hello', value: 'World'} Checking console, we can see two requests, the first request, which is called preflight request, and its response header is lik below:\nHTTP/1.1 204 No Content Access-Control-Allow-Origin: https://www.google.com Vary: Origin, Access-Control-Request-Headers Access-Control-Allow-Methods: GET,POST,PUT Content-Length: 0 Connection: keep-alive Keep-Alive: timeout=5 The headers tell the browser that cross-origin request to ‘http://localhost:3000/’ is allowed for origin https://www.google.com, but only applies to three methods: GET, POST and PUT, which are same as what we defined in our CORS config.\nAnother request is the real cross-origin request, with PUT method, and server returns response with content.\nPreflight Request We demonstrate Access-Control-Allow-Methods problem, but what is preflight response in above error\nPreflight request is an OPTIONS request automatically sent by browser before a cross origin request. Preflight request is used to determine if a cross origin request is safe. Preflight request including header Origin, Access-Control-Request-Method and Access-Control-Request-Headers (Optional) How Does Preflight Request Work Browser sends an OPTIONS request to the server with headers mentioned above OPTIONS / HTTP/1.1 Access-Control-Request-Method: PUT Host: localhost:3000 Origin: https://www.google.com Sec-Fetch-Mode: cors Sec-Fetch-Site: cross-site Server receives the preflight request and check its CORS configuration. It determines if the real cross-origin request has proper permission by checking origin, method and headers in the preflight request\nIf the real request is allowed, server responds to the preflight request with appropriate CORS headers, including allowed origins, methods and headers.\nAfter receiving preflight response from the server, if the server allows the request, then browser will send the real cross-origin request to the server. If not, browser will block the request and prevent it from reaching the server\nIf we include headers in the request\nfetch(\"http://localhost:3000\", { method: \"PUT\", headers: { \"Customer-Header\": \"key=value\", \"X-Customer-Header\": \"key=value\", \"Cookie\": \"value\" } }).then((req) =\u003e req.json()).then(console.log); Here we include two customer headers: Customer-Header and X-Customer-Header, and the preflight request and response are like below\nRequest OPTIONS / HTTP/1.1 Access-Control-Request-Headers: customer-header,x-customer-header Access-Control-Request-Method: PUT Host: localhost:3000 Origin: https://www.google.com Some headers are omitted, but you can see here preflight request tells server which headers are included in the cross-origin request.\nResponse HTTP/1.1 204 No Content Access-Control-Allow-Origin: https://www.google.com Access-Control-Allow-Methods: GET,POST,PUT Access-Control-Allow-Headers: customer-header,x-customer-header Access-Control-Allow-Credentials Header The Access-Control-Allow-Credentials response header tells browsers whether to expose the response to the frontend JavaScript code when the request’s credentials mode (Request.credentials) is include.\nIssue Demonstration Make below call in your browser console under Google domain\nfetch(\"http://localhost:3000\", { method: \"PUT\", credentials: \"include\" }).then((req) =\u003e req.json()).then(console.log); You will see error message:\nAccess to fetch at 'http://localhost:3000/' from origin 'https://www.google.com' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: The value of the 'Access-Control-Allow-Credentials' header in the response is '' which must be 'true' when the request's credentials mode is 'include'. That is because you want to include credentials, including cookies, authorization headers, or TLS client certificates, in your request.\nRemember if you don’t explicitly specify credentials: \"include\" in your request, cookies will not be added in your request’s headers\nSolution Set credentials to true in server’s CORS config\napp.use(cors({ origin: \"https://www.google.com\", methods: [\"GET\", \"POST\", \"PUT\"], credentials: true })); Access-Control-Allow-Headers Header Used in response to a preflight request to indicate which HTTP headers can be used when making the actual request.\nProblem Demonstration Limit Content-Type as the only header which server allowed\napp.use(cors({ origin: \"https://www.google.com\", methods: [\"GET\", \"POST\", \"PUT\"], allowedHeaders: ['Content-Type'] })); Then make a call from Google domain with two customer headers\nfetch(\"http://localhost:3000\", { method: \"PUT\", headers: { \"Customer-Header\": \"key=value\", \"X-Customer-Header\": \"key=value\", \"Cookie\": \"value\" } }).then((req) =\u003e req.json()).then(console.log); The request was denied with below error message\nAccess to fetch at 'http://localhost:3000/' from origin 'https://www.google.com' has been blocked by CORS policy: Request header field customer-header is not allowed by Access-Control-Allow-Headers in preflight response. Solution Add customers header as allowed headers\napp.use(cors({ origin: \"https://www.google.com\", methods: [\"GET\", \"POST\", \"PUT\"], allowedHeaders: [\"Content-Type\", \"Customer-Header\", \"X-Customer-Header\"], })); Reference YouTube video CORS Preflight Request Access-Control-Allow-Credentials ",
  "wordCount" : "1101",
  "inLanguage": "en",
  "datePublished": "2023-10-30T08:44:30-07:00",
  "dateModified": "2023-10-30T08:44:30-07:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://whatsBehind.github.io/programming/web/glossary/cors/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "What's Behind",
    "logo": {
      "@type": "ImageObject",
      "url": "https://whatsBehind.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://whatsBehind.github.io/" accesskey="h" title="What&#39;s Behind (Alt + H)">What&#39;s Behind</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      CORS
    </h1>
    <div class="post-meta"><span title='2023-10-30 08:44:30 -0700 PDT'>October 30, 2023</span>

</div>
  </header> 
  <div class="post-content"><h3 id="whats-cors">What&rsquo;s CORS<a hidden class="anchor" aria-hidden="true" href="#whats-cors">#</a></h3>
<p><code>CORS</code> is a mechanism to stop you from accessing resource in one origin from another origin. For example, there is an image <code>img.jpg</code> from origin <code>images.com</code>, if you don&rsquo;t have CORS set properly, you can&rsquo;t access the <code>img.jpg</code> from other origins like <code>yourOrigin.com</code>.</p>
<h3 id="why-needs-cors">Why needs CORS<a hidden class="anchor" aria-hidden="true" href="#why-needs-cors">#</a></h3>
<p><code>CORS</code> is mainly for security usage. Image that your browser stores credential cookies of domain <code>bank.com</code> which is the website of you bank account, and a hacking website <code>hacking.com</code> want to access your bank information and make a transaction from your bank. If without CORS, the javascript script from <code>hacking.com</code> is able to get the cookies under domain <code>bank.com</code> and make requests to <code>bank.com</code>.
<code>CORS</code> can protect your website from malicious requests</p>
<h3 id="access-control-allow-origin-header"><code>Access-Control-Allow-Origin</code> Header<a hidden class="anchor" aria-hidden="true" href="#access-control-allow-origin-header">#</a></h3>
<h4 id="issue-demonstration">Issue Demonstration<a hidden class="anchor" aria-hidden="true" href="#issue-demonstration">#</a></h4>
<p>Start a local host</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;express&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hello&#34;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;World&#34;</span>})
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#ae81ff">3000</span>);
</span></span></code></pre></div><p>In your browser, navigate to <code>http://localhost:3000</code>. Open console and make a <code>GET</code> request to <code>http://localhost:3000</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;http://localhost:3000&#34;</span>).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">req</span>) =&gt; <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">json</span>()).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>);
</span></span></code></pre></div><p>You will receive a successful response</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Hello&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;World&#39;</span>}
</span></span></code></pre></div><p>You didn&rsquo;t see any <code>CORS</code> issues, cause you were making request from <code>http://localhost:3000</code> to same origin.</p>
<p>Open a new tab in your browser, navigate to <code>www.google.com</code>, and make a same request. You will see error like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">Access</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">fetch</span> <span style="color:#a6e22e">at</span> <span style="color:#e6db74">&#39;http://localhost:3000/&#39;</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">origin</span> <span style="color:#e6db74">&#39;https://www.google.com&#39;</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">been</span> <span style="color:#a6e22e">blocked</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">CORS</span> <span style="color:#a6e22e">policy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">No</span> <span style="color:#e6db74">&#39;Access-Control-Allow-Origin&#39;</span> <span style="color:#a6e22e">header</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">present</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">requested</span> <span style="color:#a6e22e">resource</span>. <span style="color:#a6e22e">If</span> <span style="color:#a6e22e">an</span> <span style="color:#a6e22e">opaque</span> <span style="color:#a6e22e">response</span> <span style="color:#a6e22e">serves</span> <span style="color:#a6e22e">your</span> <span style="color:#a6e22e">needs</span>, <span style="color:#a6e22e">set</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">request</span><span style="color:#e6db74">&#39;s mode to &#39;</span><span style="color:#a6e22e">no</span><span style="color:#f92672">-</span><span style="color:#a6e22e">cors</span><span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">fetch</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">resource</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">CORS</span> <span style="color:#a6e22e">disabled</span>.
</span></span></code></pre></div><h4 id="solution">Solution<a hidden class="anchor" aria-hidden="true" href="#solution">#</a></h4>
<p>Add <code>www.google.com</code> in allowed origins in your <code>CORS</code> config</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;express&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">cors</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;cors&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>({
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">origin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://www.google.com&#34;</span>
</span></span><span style="display:flex;"><span>}));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hello&#34;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;World&#34;</span>})
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#ae81ff">3000</span>);
</span></span></code></pre></div><p>Make a same request again to local host, and the error is gone and you will see response printed in console:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Hello&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;World&#39;</span>}
</span></span></code></pre></div><h3 id="access-control-allow-methods-header"><code>Access-Control-Allow-Methods</code> Header<a hidden class="anchor" aria-hidden="true" href="#access-control-allow-methods-header">#</a></h3>
<h4 id="problem-demonstration">Problem Demonstration<a hidden class="anchor" aria-hidden="true" href="#problem-demonstration">#</a></h4>
<p>To demonstration the problem with <code>Access-Control-Allow-Methods</code> header</p>
<ul>
<li>I add <code>GET</code> and <code>POST</code> as allowed methods in <code>CORS</code> config, which limits that clients can only use <code>GET</code> or <code>POST</code> methods in their requests to the server</li>
<li>Also, I changed the method provided by the server from <code>GET</code> to <code>PUT</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>({
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">origin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://www.google.com&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;POST&#34;</span>],
</span></span><span style="display:flex;"><span>}));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#39;/&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hello&#34;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;World&#34;</span>})
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>Then let&rsquo;s make request in the console under <code>www.google.com</code> domain</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;http://localhost:3000&#34;</span>, {<span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>}).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">req</span>) =&gt; <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">json</span>()).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>);
</span></span></code></pre></div><p>We will see error:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">www</span>.<span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/:</span><span style="color:#ae81ff">1</span> <span style="color:#a6e22e">Access</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">fetch</span> <span style="color:#a6e22e">at</span> <span style="color:#e6db74">&#39;http://localhost:3000/&#39;</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">origin</span> <span style="color:#e6db74">&#39;https://www.google.com&#39;</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">been</span> <span style="color:#a6e22e">blocked</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">CORS</span> <span style="color:#a6e22e">policy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Method</span> <span style="color:#a6e22e">PUT</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">allowed</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Methods</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">preflight</span> <span style="color:#a6e22e">response</span>.
</span></span></code></pre></div><h4 id="solution-1">Solution<a hidden class="anchor" aria-hidden="true" href="#solution-1">#</a></h4>
<p>Add <code>PUT</code> in allowed methods</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>({
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">origin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://www.google.com&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;POST&#34;</span>, <span style="color:#e6db74">&#34;PUT&#34;</span>],
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><p>Make the same request from <code>www.google.com</code> again, and this time the error was gone and we receive correct response.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>{<span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Hello&#39;</span>, <span style="color:#a6e22e">value</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;World&#39;</span>}
</span></span></code></pre></div><p>Checking console, we can see two requests, the first request, which is called preflight request, and its response header is lik below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">204</span> <span style="color:#a6e22e">No</span> <span style="color:#a6e22e">Content</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Origin</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//www.google.com
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Vary</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Origin</span>, <span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Request</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Headers</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Methods</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">GET</span>,<span style="color:#a6e22e">POST</span>,<span style="color:#a6e22e">PUT</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Content</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Length</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Connection</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">keep</span><span style="color:#f92672">-</span><span style="color:#a6e22e">alive</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Keep</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Alive</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">timeout</span><span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span></code></pre></div><p>The headers tell the browser that cross-origin request to &lsquo;http://localhost:3000/&rsquo; is allowed for origin <code>https://www.google.com</code>, but only applies to three methods: <code>GET</code>, <code>POST</code> and <code>PUT</code>, which are same as what we defined in our <code>CORS</code> config.</p>
<p>Another request is the real cross-origin request, with <code>PUT</code> method, and server returns response with content.</p>
<h3 id="preflight-request">Preflight Request<a hidden class="anchor" aria-hidden="true" href="#preflight-request">#</a></h3>
<p>We demonstrate <code>Access-Control-Allow-Methods</code> problem, but what is preflight response in above error</p>
<ul>
<li>Preflight request is an <code>OPTIONS</code> request automatically sent by browser before a cross origin request.</li>
<li>Preflight request is used to determine if a cross origin request is safe.</li>
<li>Preflight request including header <code>Origin</code>, <code>Access-Control-Request-Method</code> and <code>Access-Control-Request-Headers</code> (Optional)</li>
</ul>
<h4 id="how-does-preflight-request-work">How Does Preflight Request Work<a hidden class="anchor" aria-hidden="true" href="#how-does-preflight-request-work">#</a></h4>
<ul>
<li>Browser sends an <code>OPTIONS</code> request to the server with headers mentioned above</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">OPTIONS</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Request</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Method</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">PUT</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Host</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">localhost</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Origin</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//www.google.com
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Sec</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Fetch</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Mode</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cors</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Sec</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Fetch</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Site</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">cross</span><span style="color:#f92672">-</span><span style="color:#a6e22e">site</span>
</span></span></code></pre></div><ul>
<li>
<p>Server receives the preflight request and check its <code>CORS</code> configuration. It determines if the real cross-origin request has proper permission by checking origin, method and headers in the preflight request</p>
</li>
<li>
<p>If the real request is allowed, server responds to the preflight request with appropriate <code>CORS</code> headers, including allowed origins, methods and headers.</p>
</li>
<li>
<p>After receiving preflight response from the server, if the server allows the request, then browser will send the real cross-origin request to the server. If not, browser will block the request and prevent it from reaching the server</p>
</li>
</ul>
<p>If we include headers in the request</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;http://localhost:3000&#34;</span>, {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>, 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Customer-Header&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;key=value&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;X-Customer-Header&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;key=value&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Cookie&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;value&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">req</span>) =&gt; <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">json</span>()).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>);
</span></span></code></pre></div><p>Here we include two customer headers: <code>Customer-Header</code> and <code>X-Customer-Header</code>, and the preflight request and response are like below</p>
<ul>
<li>Request</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">OPTIONS</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Request</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Headers</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">customer</span><span style="color:#f92672">-</span><span style="color:#a6e22e">header</span>,<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">customer</span><span style="color:#f92672">-</span><span style="color:#a6e22e">header</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Request</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Method</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">PUT</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Host</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">localhost</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3000</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Origin</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//www.google.com
</span></span></span></code></pre></div><p>Some headers are omitted, but you can see here preflight request tells server which headers are included in the cross-origin request.</p>
<ul>
<li>Response</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">204</span> <span style="color:#a6e22e">No</span> <span style="color:#a6e22e">Content</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Origin</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//www.google.com
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Methods</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">GET</span>,<span style="color:#a6e22e">POST</span>,<span style="color:#a6e22e">PUT</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Headers</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">customer</span><span style="color:#f92672">-</span><span style="color:#a6e22e">header</span>,<span style="color:#a6e22e">x</span><span style="color:#f92672">-</span><span style="color:#a6e22e">customer</span><span style="color:#f92672">-</span><span style="color:#a6e22e">header</span>
</span></span></code></pre></div><h3 id="access-control-allow-credentials-header"><code>Access-Control-Allow-Credentials</code> Header<a hidden class="anchor" aria-hidden="true" href="#access-control-allow-credentials-header">#</a></h3>
<p>The <code>Access-Control-Allow-Credentials</code> response header tells browsers whether to expose the response to the frontend JavaScript code when the request&rsquo;s credentials mode (Request.credentials) is include.</p>
<h4 id="issue-demonstration-1">Issue Demonstration<a hidden class="anchor" aria-hidden="true" href="#issue-demonstration-1">#</a></h4>
<p>Make below call in your browser console under Google domain</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;http://localhost:3000&#34;</span>, {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>, 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">credentials</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;include&#34;</span>
</span></span><span style="display:flex;"><span>}).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">req</span>) =&gt; <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">json</span>()).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>);
</span></span></code></pre></div><p>You will see error message:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">Access</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">fetch</span> <span style="color:#a6e22e">at</span> <span style="color:#e6db74">&#39;http://localhost:3000/&#39;</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">origin</span> <span style="color:#e6db74">&#39;https://www.google.com&#39;</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">been</span> <span style="color:#a6e22e">blocked</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">CORS</span> <span style="color:#a6e22e">policy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Response</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">preflight</span> <span style="color:#a6e22e">request</span> <span style="color:#a6e22e">doesn</span><span style="color:#e6db74">&#39;t pass access control check: The value of the &#39;</span><span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Credentials</span><span style="color:#e6db74">&#39; header in the response is &#39;&#39; which must be &#39;</span><span style="color:#66d9ef">true</span><span style="color:#e6db74">&#39; when the request&#39;</span><span style="color:#a6e22e">s</span> <span style="color:#a6e22e">credentials</span> <span style="color:#a6e22e">mode</span> <span style="color:#a6e22e">is</span> <span style="color:#e6db74">&#39;include&#39;</span>.
</span></span></code></pre></div><p>That is because you want to include credentials, including cookies, authorization headers, or TLS client certificates, in your request.</p>
<p>Remember if you don&rsquo;t explicitly specify <code>credentials: &quot;include&quot;</code> in your request, cookies will not be added in your request&rsquo;s headers</p>
<h4 id="solution-2">Solution<a hidden class="anchor" aria-hidden="true" href="#solution-2">#</a></h4>
<p>Set <code>credentials</code> to <code>true</code> in server&rsquo;s <code>CORS</code> config</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>({
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">origin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://www.google.com&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;POST&#34;</span>, <span style="color:#e6db74">&#34;PUT&#34;</span>],
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">credentials</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><h3 id="access-control-allow-headers-header"><code>Access-Control-Allow-Headers</code> Header<a hidden class="anchor" aria-hidden="true" href="#access-control-allow-headers-header">#</a></h3>
<p>Used in response to a preflight request to indicate which HTTP headers can be used when making the actual request.</p>
<h4 id="problem-demonstration-1">Problem Demonstration<a hidden class="anchor" aria-hidden="true" href="#problem-demonstration-1">#</a></h4>
<p>Limit <code>Content-Type</code> as the only header which server allowed</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>({
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">origin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://www.google.com&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;POST&#34;</span>, <span style="color:#e6db74">&#34;PUT&#34;</span>],
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">allowedHeaders</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;Content-Type&#39;</span>]
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><p>Then make a call from Google domain with two customer headers</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;http://localhost:3000&#34;</span>, {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;PUT&#34;</span>, 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Customer-Header&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;key=value&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;X-Customer-Header&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;key=value&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Cookie&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;value&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}).<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">req</span>) =&gt; <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">json</span>()).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>);
</span></span></code></pre></div><p>The request was denied with below error message</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">Access</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">fetch</span> <span style="color:#a6e22e">at</span> <span style="color:#e6db74">&#39;http://localhost:3000/&#39;</span> <span style="color:#a6e22e">from</span> <span style="color:#a6e22e">origin</span> <span style="color:#e6db74">&#39;https://www.google.com&#39;</span> <span style="color:#a6e22e">has</span> <span style="color:#a6e22e">been</span> <span style="color:#a6e22e">blocked</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">CORS</span> <span style="color:#a6e22e">policy</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Request</span> <span style="color:#a6e22e">header</span> <span style="color:#a6e22e">field</span> <span style="color:#a6e22e">customer</span><span style="color:#f92672">-</span><span style="color:#a6e22e">header</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">allowed</span> <span style="color:#a6e22e">by</span> <span style="color:#a6e22e">Access</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Control</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Allow</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Headers</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">preflight</span> <span style="color:#a6e22e">response</span>.
</span></span></code></pre></div><h4 id="solution-3">Solution<a hidden class="anchor" aria-hidden="true" href="#solution-3">#</a></h4>
<p>Add customers header as allowed headers</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">cors</span>({
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">origin</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;https://www.google.com&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;POST&#34;</span>, <span style="color:#e6db74">&#34;PUT&#34;</span>],
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">allowedHeaders</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;Content-Type&#34;</span>, <span style="color:#e6db74">&#34;Customer-Header&#34;</span>, <span style="color:#e6db74">&#34;X-Customer-Header&#34;</span>],
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><h3 id="reference">Reference<a hidden class="anchor" aria-hidden="true" href="#reference">#</a></h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=PNtFSVU-YTI">YouTube video</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/CORS">CORS</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request">Preflight Request</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials">Access-Control-Allow-Credentials</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://whatsBehind.github.io/">What&#39;s Behind</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
