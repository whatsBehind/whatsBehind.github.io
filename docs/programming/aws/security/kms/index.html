<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="What is KMS? # AWS Key Management Service is a full management service to generate and manage encryption keys
Key Concepts # Customer Master Key (CMK) # CMKs are primary resources created and managed by KMS. It&rsquo;s a logical representation of a master key. It includes metadata like key ID, description, alias and key state. More importantly, it contains key materials which are used to encrypt and decrypt your data.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://whatsBehind.github.io/docs/programming/aws/security/kms/">
  <meta property="og:site_name" content="What&#39;s Behind">
  <meta property="og:title" content="KMS">
  <meta property="og:description" content="What is KMS? # AWS Key Management Service is a full management service to generate and manage encryption keys
Key Concepts # Customer Master Key (CMK) # CMKs are primary resources created and managed by KMS. Itâ€™s a logical representation of a master key. It includes metadata like key ID, description, alias and key state. More importantly, it contains key materials which are used to encrypt and decrypt your data.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>KMS | What&#39;s Behind</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="https://whatsBehind.github.io/docs/programming/aws/security/kms/">
<link rel="stylesheet" href="/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css" integrity="sha256-MJt&#43;0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.fa844030d08e95a7abe4c3f0fa03b984173b58d0b03411834887525a2fd939d9.js" integrity="sha256-&#43;oRAMNCOlaer5MPw&#43;gO5hBc7WNCwNBGDSIdSWi/ZOdk=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>What&#39;s Behind</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Programming</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-eca28b761422c4017b94002a44eae355" class="toggle"  />
    <label for="section-eca28b761422c4017b94002a44eae355" class="flex justify-between">
      <a role="button" class="">Backend</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0ef9353eeeaaa2e712636b20cef819bd" class="toggle"  />
    <label for="section-0ef9353eeeaaa2e712636b20cef819bd" class="flex justify-between">
      <a role="button" class="">Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6d661aeeb5f983714eda94738c952867" class="toggle"  />
    <label for="section-6d661aeeb5f983714eda94738c952867" class="flex justify-between">
      <a role="button" class="">Nio</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/byte-buffer/" class="">Byte Buffer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/blocking-mode/" class="">Blocking Mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/unblocking-mode/" class="">Unblocking Mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/selector/" class="">Selector</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/selector-read/" class="">Selector Read</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/io-model-summary/" class="">I/O  Model Summary</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/multiple-threads/" class="">Multiple Threads</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b996168529cd69f060de2ebed180d38e" class="toggle"  />
    <label for="section-b996168529cd69f060de2ebed180d38e" class="flex justify-between">
      <a role="button" class="">Net</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/net/tcp-socket/" class="">Tcp Socket</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c52490d9096abcb758f801b4ee7eca56" class="toggle"  />
    <label for="section-c52490d9096abcb758f801b4ee7eca56" class="flex justify-between">
      <a role="button" class="">Io</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/decorator-pattern-in-java-io/" class="">Decorator Pattern in Java IO</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/object-input-and-output-stream/" class="">ObjectInputStream and ObjectOutputStream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/stream-reader-bridge-of-byte-and-char/" class="">Stream Reader: Bridge of Byte and Char</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/io-stream/" class="">Java IO Stream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/file/" class="">Java File</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e24e7d8d92b6a9f48fae63ed1f8e476c" class="toggle"  />
    <label for="section-e24e7d8d92b6a9f48fae63ed1f8e476c" class="flex justify-between">
      <a role="button" class="">Thread</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/start-thread/" class="">Start Thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/common-methods/" class="">Common Methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/thread-lifecycle/" class="">Thread Lifecycle</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/synchornization/" class="">Synchronization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/thread-safety/" class="">Thread Safety</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/reflection/" class="">Reflection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-700f7fbf6d3aaecb4ab38c518403c448" class="toggle"  />
    <label for="section-700f7fbf6d3aaecb4ab38c518403c448" class="flex justify-between">
      <a role="button" class="">Netty</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/netty/event-loop-group/" class="">EventLoop &amp; EventLoopGroup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/netty/channel/" class="">Channel &amp; ChannelFuture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/netty/pipeline-handler/" class="">Pipeline &amp; Handler</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7ce3689c52c4ddd4486357e6ce0409f7" class="toggle"  />
    <label for="section-7ce3689c52c4ddd4486357e6ce0409f7" class="flex justify-between">
      <a role="button" class="">Python</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/python/executing-a-python-file/" class="">How Is Python File Executed</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c94bdc48cc72a10f9750698bd760b496" class="toggle"  />
    <label for="section-c94bdc48cc72a10f9750698bd760b496" class="flex justify-between">
      <a role="button" class="">Project</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/project/online-chat/" class="">Online Chat</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/project/node-js-auth/" class="">Node Js Auth</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0e532608ee91345a4a35cfb45ce211d1" class="toggle"  />
    <label for="section-0e532608ee91345a4a35cfb45ce211d1" class="flex justify-between">
      <a role="button" class="">Os</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7ed5523c642ad46d1578230786a8db5d" class="toggle"  />
    <label for="section-7ed5523c642ad46d1578230786a8db5d" class="flex justify-between">
      <a role="button" class="">Linux</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/os/linux/linux-manual/" class="">Linux Manual</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-efb1407d62e73a8a817711e3fba4de9c" class="toggle"  />
    <label for="section-efb1407d62e73a8a817711e3fba4de9c" class="flex justify-between">
      <a role="button" class="">MAC Os</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-1a3a25c54274eb9ddf23020bba0cdbfb" class="toggle"  />
    <label for="section-1a3a25c54274eb9ddf23020bba0cdbfb" class="flex justify-between">
      <a role="button" class="">Terminal Command</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/os/mac-os/terminal-command/text-processing-and-searching/" class="">Text Processing and Searching</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e0b6d6801838f2b3dd490821e43524a7" class="toggle"  />
    <label for="section-e0b6d6801838f2b3dd490821e43524a7" class="flex justify-between">
      <a role="button" class="">Web</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-71f41ee591103342b6c17608020c2cb3" class="toggle"  />
    <label for="section-71f41ee591103342b6c17608020c2cb3" class="flex justify-between">
      <a role="button" class="">Glossary</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/glossary/cors/" class="">CORS</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2f5e221e70b8f0e9ab5d58bace04b60b" class="toggle"  />
    <label for="section-2f5e221e70b8f0e9ab5d58bace04b60b" class="flex justify-between">
      <a role="button" class="">Web API</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/web-api/web-storage-api/" class="">Web Storage Api</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-85860536baf35c0d2e30b2f54dce7ab8" class="toggle"  />
    <label for="section-85860536baf35c0d2e30b2f54dce7ab8" class="flex justify-between">
      <a role="button" class="">HTTP</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/http/cookie/" class="">Cookie</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ac646c5ee24949b9e8c3a07548f95ea4" class="toggle"  />
    <label for="section-ac646c5ee24949b9e8c3a07548f95ea4" class="flex justify-between">
      <a role="button" class="">Security</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/security/asymmetric-encryption/" class="">Asymmetric Encryption</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/security/tls-handshake/" class="">TLS Handshake</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/security/session-vs-token/" class="">Session vs Token</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9bbc07e9cf5a3dd1f0670b58cc26fe7d" class="toggle"  />
    <label for="section-9bbc07e9cf5a3dd1f0670b58cc26fe7d" class="flex justify-between">
      <a role="button" class="">Tools</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9a57184de34a650b7e802c8a3175c764" class="toggle"  />
    <label for="section-9a57184de34a650b7e802c8a3175c764" class="flex justify-between">
      <a role="button" class="">Hugo</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/tools/hugo/set-up-hugo-in-git-hub-pages/" class="">Set Up Hugo in Git Hub Pages</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-973779c9194adc86298e028d295f6f5e" class="toggle" checked />
    <label for="section-973779c9194adc86298e028d295f6f5e" class="flex justify-between">
      <a role="button" class="">Aws</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/aws/cloudformation/" class="">CloudFormation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-1655a5eb0fd2d3d2770bffd5cb198b50" class="toggle"  />
    <label for="section-1655a5eb0fd2d3d2770bffd5cb198b50" class="flex justify-between">
      <a role="button" class="">Message</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/aws/message/sns/" class="">SNS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/aws/message/sqs/" class="">SQS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/aws/message/eventbridge/" class="">EventBridge</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-76769177bd065f12742ea50362a7ab48" class="toggle" checked />
    <label for="section-76769177bd065f12742ea50362a7ab48" class="flex justify-between">
      <a role="button" class="">Security</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/aws/security/kms/" class="active">KMS</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8cc8252e831d02a7053a71a00d99d1ee" class="toggle"  />
    <label for="section-8cc8252e831d02a7053a71a00d99d1ee" class="flex justify-between">
      <a role="button" class="">Network</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/network/dns/" class="">DNS</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/network/dns-hands-on/" class="">DNS Hands On</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c77786c61c4d41dd20c5b2d72a718a0f" class="toggle"  />
    <label for="section-c77786c61c4d41dd20c5b2d72a718a0f" class="flex justify-between">
      <a role="button" class="">System Design</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/system-design/load-balancer/" class="">Load Balancer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-264f85fc5494c4e02ddec05bf36defa3" class="toggle"  />
    <label for="section-264f85fc5494c4e02ddec05bf36defa3" class="flex justify-between">
      <a role="button" class="">Design Data Intensive Applications</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/system-design/design-data-intensive-applications/replication/" class="">Replication</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/system-design/design-data-intensive-applications/partition/" class="">Partition</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/system-design/design-data-intensive-applications/transactions/" class="">Transactions</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a8ea8d01186e9944288c4a6ce6c90b2c" class="toggle"  />
    <label for="section-a8ea8d01186e9944288c4a6ce6c90b2c" class="flex justify-between">
      <a role="button" class="">Monitoring</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/system-design/monitoring/metric-log/" class="">Metric &amp; Log</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>KMS</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-kms">What is KMS?</a></li>
    <li><a href="#key-concepts">Key Concepts</a>
      <ul>
        <li><a href="#customer-master-key-cmk">Customer Master Key (CMK)</a></li>
        <li><a href="#key-policies">Key policies</a></li>
        <li><a href="#data-keys">Data Keys</a>
          <ul>
            <li><a href="#why-need-data-keys">Why Need Data Keys?</a></li>
            <li><a href="#how-to-use-data-keys">How to Use Data Keys?</a></li>
          </ul>
        </li>
        <li><a href="#envelop-encryption">Envelop Encryption</a></li>
      </ul>
    </li>
    <li><a href="#how-aws-services-utilize-kms">How AWS Services Utilize KMS</a>
      <ul>
        <li><a href="#data-protection">Data Protection</a></li>
        <li><a href="#s3-server-side-encryption">S3 Server-Side Encryption</a>
          <ul>
            <li><a href="#sse-s3">SSE-S3</a></li>
            <li><a href="#sse-kms">SSE-KMS</a></li>
            <li><a href="#sse-c">SSE-C</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="what-is-kms">
  What is KMS?
  <a class="anchor" href="#what-is-kms">#</a>
</h1>
<p>AWS Key Management Service is a full management service to generate and manage encryption keys</p>
<h1 id="key-concepts">
  Key Concepts
  <a class="anchor" href="#key-concepts">#</a>
</h1>
<h2 id="customer-master-key-cmk">
  Customer Master Key (CMK)
  <a class="anchor" href="#customer-master-key-cmk">#</a>
</h2>
<p>CMKs are primary resources created and managed by KMS. It&rsquo;s a logical representation of a master key. It includes metadata like key ID, description, alias and key state. More importantly, it contains key materials which are used to encrypt and decrypt your data.</p>
<p>CMKs can be:</p>
<ul>
<li>Customer-managed: These are created and managed by AWS users</li>
<li>AWS-managed: There are created and managed by AWS services, like <code>aws/s3</code>, <code>aws/ddb</code> etc&hellip;</li>
</ul>
<h2 id="key-policies">
  Key policies
  <a class="anchor" href="#key-policies">#</a>
</h2>
<p>Key policies are resource policies that are attached to every CMK to determine who has what permissions on the CMK under which conditions. Every CMK must have one and only one key policy</p>
<h2 id="data-keys">
  Data Keys
  <a class="anchor" href="#data-keys">#</a>
</h2>
<p>Data keys are <strong>SYMMETRIC</strong> keys generated by AWS KMS. They are normally used to encrypt and decrypt large size data on client side. You can use CMK to generate, encrypt and decrypt data keys</p>
<h3 id="why-need-data-keys">
  Why Need Data Keys?
  <a class="anchor" href="#why-need-data-keys">#</a>
</h3>
<p>AWS KMS APIs <code>kms:Encrypt</code> and <code>kms:Decrypt</code> only support data size less than 4 KB. The workaround to encrypt large size data is that KMS generates data keys and clients use the generated data keys to encrypt and decrypt large size data on their sides and no need to upload the data to KMS.</p>
<h3 id="how-to-use-data-keys">
  How to Use Data Keys?
  <a class="anchor" href="#how-to-use-data-keys">#</a>
</h3>
<h4 id="creating-a-cmk">
  Creating a CMK
  <a class="anchor" href="#creating-a-cmk">#</a>
</h4>
<ul>
<li>
<p>First calling <code>create-key</code> API to create a CMK</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>aws kms create-key 
</span></span></code></pre></div><p>You will get response like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;KeyMetadata&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;KeyId&#34;</span>: <span style="color:#e6db74">&#34;bca1a73c-b9d2-43e2-97e7-XXXXXXXXXXXX&#34;</span>,
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>Creating an alias for the CMK</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>aws kms create-alias --target-key-id <span style="color:#e6db74">&#34;bca1a73c-b9d2-43e2-97e7-XXXXXXXXXXXX&#34;</span> --alias-name alias/demo-data-key
</span></span></code></pre></div></li>
</ul>
<p>We won&rsquo;t use the generated CMK to encrypt data, but use the data key. That is called <a href="#envelop-encryption">Envelop Encryption</a></p>
<h4 id="generating-a-data-key">
  Generating a Data Key
  <a class="anchor" href="#generating-a-data-key">#</a>
</h4>
<ul>
<li>
<p>Generating a symmetric data key</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>aws kms generate-data-key --key-id alias/demo-data-key --key-spec AES_256
</span></span></code></pre></div><p>You will get response:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;CiphertextBlob&#34;</span>: <span style="color:#e6db74">&#34;AQIDAHiNuXXnu8SiDat5B2+53PrUzQvrztxy2goKhceTVwNoDAFboLcM9DYLJRprvSF16VWhAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMaAKf1DtSn99SoSYsAgEQgDsPACB1itRaJX6yTjEQuWidGXpMYwL9x47oxbepRkjQjIta4jdisEZU3VbqJhGRKLJzwFepzU+ofZWKBA==&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Plaintext&#34;</span>: <span style="color:#e6db74">&#34;tJ6HM0yWt2SwkEGDhG7IgVilYlU8j2IaX+wrr24Af7w=&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;KeyId&#34;</span>: <span style="color:#e6db74">&#34;arn\:aws\:kms\:eu-central-1\:XXXXXXXXXXXX\:key/0265a04d-b823-4a16-9fbe-772a5cb6baea&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><ul>
<li>
<p>Components</p>
<ul>
<li>Plaintext:
<ul>
<li>The data key, unencrypted.</li>
<li>It is used to encrypt or decrypt data by clients.</li>
<li>Clients should remove it from memory every time after use it</li>
</ul>
</li>
<li>CiphertextBlob:
<ul>
<li>The data key, encrypted by the CMK.</li>
<li>Clients should keep it persistently.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Relationship</p>
<p>The plaintext and encrypted data key are generated by running an encryption algorithm on the CMK. One CMK can generate multiple data keys</p>
<p><img src="/docs/programming/aws/security/kms/generate-data-key.png" alt="generate-data-key" /></p>
</li>
</ul>
</li>
<li>
<p>Storing encrypted data key</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>export DATA_KEY_CIPHERTEXT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;AQIDAHiNuXXnu8SiDat5B2+53PrUzQvrztxy2goKhceTVwNoDAFboLcM9DYLJRprvSF16VWhAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMaAKf1DtSn99SoSYsAgEQgDsPACB1itRaJX6yTjEQuWidGXpMYwL9x47oxbepRkjQjIta4jdisEZU3VbqJhGRKLJzwFepzU+ofZWKBA==&#34;</span>
</span></span><span style="display:flex;"><span>echo $DATA_KEY_CIPHERTEXT | base64 --decode &gt; data_key_ciphertext
</span></span></code></pre></div></li>
</ul>
<h4 id="decrypting-encrypted-data-key">
  Decrypting Encrypted Data Key
  <a class="anchor" href="#decrypting-encrypted-data-key">#</a>
</h4>
<p>After generating a data key, client keeps the encrypted data key and should never keep the plaintext data key in their disk. To encrypt data using data key, client needs to decrypt the encrypted data key to get the plaintext data key</p>
<p><img src="/docs/programming/aws/security/kms/kms-decrypt-with-data-key.png" alt="decrypt-data-key" /></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zsh" data-lang="zsh"><span style="display:flex;"><span>export DATA_KEY_PLAINTEXT<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>aws kms decrypt --ciphertext-blob fileb://./data_key_ciphertext --query Plaintext --output text<span style="color:#e6db74">`</span>
</span></span></code></pre></div><h4 id="encrypting-with-plaintext-data-key">
  Encrypting with Plaintext Data Key
  <a class="anchor" href="#encrypting-with-plaintext-data-key">#</a>
</h4>
<p>Now you have the plaintext data key. You can use your preferred encryption algorithm to encrypt your data with the plaintext data key. Remember to remove the plaintext data key from memory after using</p>
<p><img src="/docs/programming/aws/security/kms/kms-encrypt-with-data-key.png" alt="encrypt-with-data-key" /></p>
<h2 id="envelop-encryption">
  Envelop Encryption
  <a class="anchor" href="#envelop-encryption">#</a>
</h2>
<p>Envelop Encryption is to encrypt your plaintext data with a plaintext data key and then encrypt the plaintext data key with a master key (CMK)</p>
<p><img src="/docs/programming/aws/security/kms/envelop-encryption.png" alt="envelop-encryption" /></p>
<h1 id="how-aws-services-utilize-kms">
  How AWS Services Utilize KMS
  <a class="anchor" href="#how-aws-services-utilize-kms">#</a>
</h1>
<h2 id="data-protection">
  Data Protection
  <a class="anchor" href="#data-protection">#</a>
</h2>
<p>Data protection in AWS refers to protecting data in transit (data transmits over wire) and protecting data at rest (storing data at disk). You can protect your data in transit using TLS/SSL protocol (HTTPS), or encrypt your data at client side. To protect data at rest, you have two options:</p>
<ul>
<li>Server-Side encryption</li>
<li>Client-Side encryption</li>
</ul>
<p>Use S3 as example to introduce how KMS is involved in server-side encryption</p>
<h2 id="s3-server-side-encryption">
  S3 Server-Side Encryption
  <a class="anchor" href="#s3-server-side-encryption">#</a>
</h2>
<h3 id="sse-s3">
  SSE-S3
  <a class="anchor" href="#sse-s3">#</a>
</h3>
<p>SSE-S3 stands for Server-Side Encryption with Amazon S3-managed Keys.</p>
<ul>
<li>Default option</li>
<li>No KMS is involved, so no extra costs</li>
<li>Only S3 related permissions are required to access objects in S3 buckets</li>
</ul>
<p>It&rsquo;s the most basic encryption method provided by S3. After you upload an object to S3 buckets, before it is saved to disk, the object will be encrypted by a S3-managed key. When you download objects from S3 buckets, the encrypted objects will be decrypted first and then downloaded to client side.</p>
<h3 id="sse-kms">
  SSE-KMS
  <a class="anchor" href="#sse-kms">#</a>
</h3>
<p>SSE-KMS stands for Server-Side Encryption with CMK stored in KMS</p>
<ul>
<li>Loss: KMS is involved, so you need to pay extra costs</li>
<li>Gain: Extra layer of security. You need to have permissions of S3 and KMS to access objects in S3 buckets</li>
</ul>
<p><img src="/docs/programming/aws/security/kms/kms-iam.png" alt="SSE-KMS" /></p>
<p>To upload an object encrypted with an AWS KMS key to Amazon S3, you need <code>kms:GenerateDataKey</code> permissions on the key. To download an object encrypted with an AWS KMS key, you need <code>kms:Decrypt</code> permissions. Encryption on each object provides high security, but that results in too many calls from S3 to KMS. To balance security and HTTP traffic (also costs), instead of generating data key for each object, you can use bucket key to encrypt objects.</p>
<ul>
<li>S3 Bucket Keys for SSE-KMS
After you configure your bucket to use S3 Bucket Key for SSE-KMS, AWS generates a short-live key from AWS KMS and then keep it in S3 for a period of time. The bucket key will create data keys for new objects during its lifecycle. That eliminates a lot of requests to KMS to generate data key for each object.</li>
</ul>
<h3 id="sse-c">
  SSE-C
  <a class="anchor" href="#sse-c">#</a>
</h3>
<p>AWS S3 allows you to use custom encryption key for server-side encryption. Clients manage the encryption key and provide the key as part of their requests and S3 manages the encryption process.</p>
<h1 id="reference">
  Reference
  <a class="anchor" href="#reference">#</a>
</h1>
<p><a href="https://catalog.us-east-1.prod.workshops.aws/workshops/aad9ff1e-b607-45bc-893f-121ea5224f24/en-US">AWS KMS Workshop</a></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-kms">What is KMS?</a></li>
    <li><a href="#key-concepts">Key Concepts</a>
      <ul>
        <li><a href="#customer-master-key-cmk">Customer Master Key (CMK)</a></li>
        <li><a href="#key-policies">Key policies</a></li>
        <li><a href="#data-keys">Data Keys</a>
          <ul>
            <li><a href="#why-need-data-keys">Why Need Data Keys?</a></li>
            <li><a href="#how-to-use-data-keys">How to Use Data Keys?</a></li>
          </ul>
        </li>
        <li><a href="#envelop-encryption">Envelop Encryption</a></li>
      </ul>
    </li>
    <li><a href="#how-aws-services-utilize-kms">How AWS Services Utilize KMS</a>
      <ul>
        <li><a href="#data-protection">Data Protection</a></li>
        <li><a href="#s3-server-side-encryption">S3 Server-Side Encryption</a>
          <ul>
            <li><a href="#sse-s3">SSE-S3</a></li>
            <li><a href="#sse-kms">SSE-KMS</a></li>
            <li><a href="#sse-c">SSE-C</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












