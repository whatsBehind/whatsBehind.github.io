<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Unblocking Mode # In last post, we discussed blocking mode and its problems. In this post, we will discuss unblocking mode and its problems
Code Example # Server
@Slf4j public class Server { public static void main(String[] args) throws IOException { ByteBuffer buffer = ByteBuffer.allocate(32); ServerSocketChannel ssc = ServerSocketChannel.open(); ssc.bind(new InetSocketAddress(9999)); ssc.configureBlocking(false); List&lt;SocketChannel&gt; channels = new ArrayList&lt;&gt;(); while (true) { log.debug(&#34;Server connecting&#34;); SocketChannel sc = ssc.accept(); if (sc != null) { log.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Unblocking Mode" />
<meta property="og:description" content="Unblocking Mode # In last post, we discussed blocking mode and its problems. In this post, we will discuss unblocking mode and its problems
Code Example # Server
@Slf4j public class Server { public static void main(String[] args) throws IOException { ByteBuffer buffer = ByteBuffer.allocate(32); ServerSocketChannel ssc = ServerSocketChannel.open(); ssc.bind(new InetSocketAddress(9999)); ssc.configureBlocking(false); List&lt;SocketChannel&gt; channels = new ArrayList&lt;&gt;(); while (true) { log.debug(&#34;Server connecting&#34;); SocketChannel sc = ssc.accept(); if (sc != null) { log." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://whatsBehind.github.io/docs/programming/backend/java/nio/unblocking-mode/" /><meta property="article:section" content="docs" />



<title>Unblocking Mode | What&#39;s Behind</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="stylesheet" href="/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.7fe15b281262a8159fbec14928596a90fbaad17d25babc5b7f56d8ec1175ccbe.js" integrity="sha256-f&#43;FbKBJiqBWfvsFJKFlqkPuq0X0lurxbf1bY7BF1zL4=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>What&#39;s Behind</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Programming</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7ce6fe0c65f837fcf676f1e6ecbf9947" class="toggle"  />
    <label for="section-7ce6fe0c65f837fcf676f1e6ecbf9947" class="flex justify-between">
      <a role="button" class="">Project</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/project/online-chat/" class="">Online Chat</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7844d228e6c88ae97cf5828b0d009769" class="toggle" checked />
    <label for="section-7844d228e6c88ae97cf5828b0d009769" class="flex justify-between">
      <a role="button" class="">Backend</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-85e6d0a84cbb2566773c803dc893e0af" class="toggle" checked />
    <label for="section-85e6d0a84cbb2566773c803dc893e0af" class="flex justify-between">
      <a role="button" class="">Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-4d132fa86c191d313485f304ca9a1229" class="toggle"  />
    <label for="section-4d132fa86c191d313485f304ca9a1229" class="flex justify-between">
      <a role="button" class="">Net</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/net/tcp-socket/" class="">Tcp Socket</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f8771c290018cde58e0ed5c89ae77e0d" class="toggle"  />
    <label for="section-f8771c290018cde58e0ed5c89ae77e0d" class="flex justify-between">
      <a role="button" class="">Io</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/decorator-pattern-in-java-io/" class="">Decorator Pattern in Java IO</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/object-input-and-output-stream/" class="">ObjectInputStream and ObjectOutputStream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/stream-reader-bridge-of-byte-and-char/" class="">Stream Reader: Bridge of Byte and Char</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/io-stream/" class="">Java IO Stream</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/io/file/" class="">Java File</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-51b21b1aa4706431f75da30c83254b65" class="toggle"  />
    <label for="section-51b21b1aa4706431f75da30c83254b65" class="flex justify-between">
      <a role="button" class="">Thread</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/start-thread/" class="">Start Thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/common-methods/" class="">Common Methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/thread-lifecycle/" class="">Thread Lifecycle</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/synchornization/" class="">Synchronization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/thread/thread-safety/" class="">Thread Safety</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/reflection/" class="">Reflection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-945932e727978560611817848680d393" class="toggle"  />
    <label for="section-945932e727978560611817848680d393" class="flex justify-between">
      <a role="button" class="">Netty</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/netty/event-loop-group/" class="">EventLoop &amp; EventLoopGroup</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/netty/channel/" class="">Channel &amp; ChannelFuture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/netty/pipeline-handler/" class="">Pipeline &amp; Handler</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f0c638519ab658fe62f69bdee816bc0f" class="toggle" checked />
    <label for="section-f0c638519ab658fe62f69bdee816bc0f" class="flex justify-between">
      <a role="button" class="">Nio</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/byte-buffer/" class="">Byte Buffer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/blocking-mode/" class="">Blocking Mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/unblocking-mode/" class="active">Unblocking Mode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/selector/" class="">Selector</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/selector-read/" class="">Selector Read</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/io-model-summary/" class="">I/O  Model Summary</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/backend/java/nio/multiple-threads/" class="">Multiple Threads</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3fb923816a079b91d0045c2bbe184452" class="toggle"  />
    <label for="section-3fb923816a079b91d0045c2bbe184452" class="flex justify-between">
      <a role="button" class="">Os</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-eef785d90f032562151b69894191310f" class="toggle"  />
    <label for="section-eef785d90f032562151b69894191310f" class="flex justify-between">
      <a role="button" class="">Linux</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/os/linux/linux-manual/" class="">Linux Manual</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-baafd18a53132bc7da781d43371b88b2" class="toggle"  />
    <label for="section-baafd18a53132bc7da781d43371b88b2" class="flex justify-between">
      <a role="button" class="">Web</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-eee032ba51521b5a76ca688aa982a5cd" class="toggle"  />
    <label for="section-eee032ba51521b5a76ca688aa982a5cd" class="flex justify-between">
      <a role="button" class="">Glossary</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/glossary/cors/" class="">CORS</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c0de0223513b5941f61c65ed294def20" class="toggle"  />
    <label for="section-c0de0223513b5941f61c65ed294def20" class="flex justify-between">
      <a role="button" class="">Web API</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/web-api/web-storage-api/" class="">Web Storage Api</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0975d481e131cd3566df9e7779add732" class="toggle"  />
    <label for="section-0975d481e131cd3566df9e7779add732" class="flex justify-between">
      <a role="button" class="">HTTP</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/http/cookie/" class="">Cookie</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-811d37783cbe9703bc6b3709e834ba31" class="toggle"  />
    <label for="section-811d37783cbe9703bc6b3709e834ba31" class="flex justify-between">
      <a role="button" class="">Security</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/security/asymmetric-encryption/" class="">Asymmetric Encryption</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/web/security/tls-handshake/" class="">TLS Handshake</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c91ba5e94a01028927e7fe8e471dfed6" class="toggle"  />
    <label for="section-c91ba5e94a01028927e7fe8e471dfed6" class="flex justify-between">
      <a role="button" class="">Tools</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-61b4842f6a6edc0699378637391b21b9" class="toggle"  />
    <label for="section-61b4842f6a6edc0699378637391b21b9" class="flex justify-between">
      <a role="button" class="">Hugo</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/programming/tools/hugo/set-up-hugo-in-git-hub-pages/" class="">Set Up Hugo in Git Hub Pages</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2d83032c16586068a0402c6767f2442f" class="toggle"  />
    <label for="section-2d83032c16586068a0402c6767f2442f" class="flex justify-between">
      <a role="button" class="">Network</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a047c0faadc787118d3878bd75e8b987" class="toggle"  />
    <label for="section-a047c0faadc787118d3878bd75e8b987" class="flex justify-between">
      <a role="button" class="">Note</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Unblocking Mode</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#unblocking-mode">Unblocking Mode</a>
      <ul>
        <li><a href="#code-example">Code Example</a></li>
        <li><a href="#demo">Demo</a>
          <ul>
            <li><a href="#start-the-server">Start the server</a></li>
            <li><a href="#client-connects-to-the-server">Client connects to the server</a></li>
            <li><a href="#client-sends-data-to-the-server">Client sends data to the server</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="unblocking-mode">
  Unblocking Mode
  <a class="anchor" href="#unblocking-mode">#</a>
</h1>
<p>In last post, we discussed blocking mode and its problems. In this post, we will discuss unblocking mode and its problems</p>
<h2 id="code-example">
  Code Example
  <a class="anchor" href="#code-example">#</a>
</h2>
<ul>
<li>
<p>Server</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>        ByteBuffer buffer <span style="color:#f92672">=</span> ByteBuffer.<span style="color:#a6e22e">allocate</span>(32);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ServerSocketChannel ssc <span style="color:#f92672">=</span> ServerSocketChannel.<span style="color:#a6e22e">open</span>();
</span></span><span style="display:flex;"><span>        ssc.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">new</span> InetSocketAddress(9999));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ssc.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>SocketChannel<span style="color:#f92672">&gt;</span> channels <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>            log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Server connecting&#34;</span>);
</span></span><span style="display:flex;"><span>            SocketChannel sc <span style="color:#f92672">=</span> ssc.<span style="color:#a6e22e">accept</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (sc <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Connect to client &#34;</span> <span style="color:#f92672">+</span> sc.<span style="color:#a6e22e">getRemoteAddress</span>());
</span></span><span style="display:flex;"><span>                sc.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>                channels.<span style="color:#a6e22e">add</span>(sc);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (SocketChannel channel : channels) {
</span></span><span style="display:flex;"><span>                log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Server reading&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> read <span style="color:#f92672">=</span> channel.<span style="color:#a6e22e">read</span>(buffer);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (read <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>                    buffer.<span style="color:#a6e22e">flip</span>();
</span></span><span style="display:flex;"><span>                    ByteBufferReader.<span style="color:#a6e22e">readAll</span>(buffer);
</span></span><span style="display:flex;"><span>                    buffer.<span style="color:#a6e22e">clear</span>();
</span></span><span style="display:flex;"><span>                    log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Read data from client &#34;</span> <span style="color:#f92672">+</span> channel.<span style="color:#a6e22e">getRemoteAddress</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Comparing with server code of blocking mode, we set blocking configuration of the <code>ServerSocketChannel</code> and <code>SocketChannel</code> to false
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>ssc.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>sc.<span style="color:#a6e22e">configureBlocking</span>(<span style="color:#66d9ef">false</span>);
</span></span></code></pre></div></li>
<li>Also we add a conditional check before adding the <code>SocketChannel</code> to the list and reading data from the channel. That is because in unblocking mode, method <code>scc.accept()</code> will not be blocked, instead it returns a <code>SocketChannel</code> object or <code>null</code> depending on if a client connects to the server. Hence, we should only add the <code>SocketChannel</code> to the list if it is not <code>null</code>, in other words, a client connects to the server.</li>
<li>Method <code>channel.read(buffer)</code> will always read from the <code>Channel</code> no matter clients send data or not. What the method returns is the length of bytes it reads. Here we only handle the data if <code>len &gt; 0</code>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (sc <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (read <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>Client</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Client</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>        SocketChannel sc <span style="color:#f92672">=</span> SocketChannel.<span style="color:#a6e22e">open</span>();
</span></span><span style="display:flex;"><span>        log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Connecting to server&#34;</span>);
</span></span><span style="display:flex;"><span>        sc.<span style="color:#a6e22e">connect</span>(<span style="color:#66d9ef">new</span> InetSocketAddress(InetAddress.<span style="color:#a6e22e">getLocalHost</span>(), 9999));
</span></span><span style="display:flex;"><span>        log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Connected with server&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>            String input <span style="color:#f92672">=</span> Scanner_.<span style="color:#a6e22e">scanLine</span>(<span style="color:#e6db74">&#34;Input: &#34;</span>);
</span></span><span style="display:flex;"><span>            log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Sending data [{}] to server&#34;</span>, input);
</span></span><span style="display:flex;"><span>            sc.<span style="color:#a6e22e">write</span>(StandardCharsets.<span style="color:#a6e22e">UTF_8</span>.<span style="color:#a6e22e">encode</span>(input));
</span></span><span style="display:flex;"><span>            log.<span style="color:#a6e22e">debug</span>(<span style="color:#e6db74">&#34;Sent data [{}] to server&#34;</span>, input);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>Client code has no difference with that code in blocking mode</li>
</ul>
</li>
</ul>
<h2 id="demo">
  Demo
  <a class="anchor" href="#demo">#</a>
</h2>
<h3 id="start-the-server">
  Start the server
  <a class="anchor" href="#start-the-server">#</a>
</h3>
<ul>
<li>
<p>Server log:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>09:26:19.<span style="color:#a6e22e">287</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server connecting
</span></span><span style="display:flex;"><span>09:26:19.<span style="color:#a6e22e">287</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server connecting
</span></span><span style="display:flex;"><span>09:26:19.<span style="color:#a6e22e">287</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server connecting
</span></span><span style="display:flex;"><span>09:26:19.<span style="color:#a6e22e">287</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server connecting
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><ul>
<li>The log <code>Server connecting</code> is printed infinitely because of unblocking mode</li>
</ul>
</li>
</ul>
<h3 id="client-connects-to-the-server">
  Client connects to the server
  <a class="anchor" href="#client-connects-to-the-server">#</a>
</h3>
<ul>
<li>
<p>Server log:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>09:28:40.<span style="color:#a6e22e">194</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server connecting
</span></span><span style="display:flex;"><span>09:28:40.<span style="color:#a6e22e">194</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server reading
</span></span><span style="display:flex;"><span>09:28:40.<span style="color:#a6e22e">194</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server connecting
</span></span><span style="display:flex;"><span>09:28:40.<span style="color:#a6e22e">194</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server reading
</span></span><span style="display:flex;"><span>09:28:40.<span style="color:#a6e22e">194</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Server connecting
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><ul>
<li>Logs are continuously printed, but this time, new log <code>Server Reading</code> is printed also because after the client connects to the server, the <code>SocketChannel</code> is added in the list, and the server unblockingly reads the channel</li>
</ul>
</li>
<li>
<p>Client log:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>09:28:33.<span style="color:#a6e22e">989</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Connecting to server
</span></span><span style="display:flex;"><span>09:28:33.<span style="color:#a6e22e">993</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Connected with server
</span></span><span style="display:flex;"><span>Input: 
</span></span></code></pre></div></li>
</ul>
<h3 id="client-sends-data-to-the-server">
  Client sends data to the server
  <a class="anchor" href="#client-sends-data-to-the-server">#</a>
</h3>
<p>To better demonstrate unblocking mode, I removed some logs in the server code to avoid logs from continuously being printed. Then I restarted the server, and connects to the client</p>
<ul>
<li>
<p>Client log:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>09:40:28.<span style="color:#a6e22e">973</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Connecting to server
</span></span><span style="display:flex;"><span>09:40:28.<span style="color:#a6e22e">976</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Connected with server
</span></span><span style="display:flex;"><span>Input: Hello Server from ClientA<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>09:40:45.<span style="color:#a6e22e">721</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Sending data <span style="color:#f92672">[</span>Hello Server from ClientA<span style="color:#f92672">!]</span> to server
</span></span><span style="display:flex;"><span>09:40:45.<span style="color:#a6e22e">722</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Sent data <span style="color:#f92672">[</span>Hello Server from ClientA<span style="color:#f92672">!]</span> to server
</span></span><span style="display:flex;"><span>Input: Hello Server from ClientA Again<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>09:40:57.<span style="color:#a6e22e">604</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Sending data <span style="color:#f92672">[</span>Hello Server from ClientA Again<span style="color:#f92672">!]</span> to server
</span></span><span style="display:flex;"><span>09:40:57.<span style="color:#a6e22e">605</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Client</span> <span style="color:#f92672">-</span> Sent data <span style="color:#f92672">[</span>Hello Server from ClientA Again<span style="color:#f92672">!]</span> to server
</span></span><span style="display:flex;"><span>Input: 
</span></span></code></pre></div><ul>
<li>A client connects to the server and sends two strings to the server. In blocking mode, the server should only receive first string and receive second string until another client connects to the server</li>
</ul>
</li>
<li>
<p>Server log</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>09:40:28.<span style="color:#a6e22e">989</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Connect to client <span style="color:#f92672">/</span>127.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">1</span>:50930
</span></span><span style="display:flex;"><span>09:40:45.<span style="color:#a6e22e">723</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">utility</span>.<span style="color:#a6e22e">ByteBufferReader</span> <span style="color:#f92672">-</span> Hello Server from ClientA<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>09:40:45.<span style="color:#a6e22e">723</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Read data from client <span style="color:#f92672">/</span>127.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">1</span>:50930
</span></span><span style="display:flex;"><span>09:40:57.<span style="color:#a6e22e">605</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">utility</span>.<span style="color:#a6e22e">ByteBufferReader</span> <span style="color:#f92672">-</span> Hello Server from ClientA Again<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>09:40:57.<span style="color:#a6e22e">605</span> <span style="color:#f92672">[</span>main<span style="color:#f92672">]</span> DEBUG com.<span style="color:#a6e22e">whatsbehind</span>.<span style="color:#a6e22e">netty_</span>.<span style="color:#a6e22e">nio</span>.<span style="color:#a6e22e">nonblocking</span>.<span style="color:#a6e22e">Server</span> <span style="color:#f92672">-</span> Read data from client <span style="color:#f92672">/</span>127.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">1</span>:50930
</span></span></code></pre></div><ul>
<li>The server connects to the client</li>
<li>Further more, it receives all strings from the client. As we can see here, because the server is running in unblocking mode, it can handle client connection and data communication concurrently</li>
</ul>
</li>
</ul>
<h2 id="summary">
  Summary
  <a class="anchor" href="#summary">#</a>
</h2>
<ul>
<li>In unblocking mode, the blocking methods get executed, so the server can handle multiple connections and receive data from multiple clients concurrently.</li>
<li>However, different from blocking mode in which the CPU is blocked for most time, CPU in unblocking mode is busy and always running. That&rsquo;s the problem of unblocking mode and it is a waste of resource cause in most time, CPU doesn&rsquo;t do any useful work but run the while loop&hellip;</li>
<li>In the next post, we will discuss how NIO uses <code>Selector</code> to handle this issue</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#unblocking-mode">Unblocking Mode</a>
      <ul>
        <li><a href="#code-example">Code Example</a></li>
        <li><a href="#demo">Demo</a>
          <ul>
            <li><a href="#start-the-server">Start the server</a></li>
            <li><a href="#client-connects-to-the-server">Client connects to the server</a></li>
            <li><a href="#client-sends-data-to-the-server">Client sends data to the server</a></li>
          </ul>
        </li>
        <li><a href="#summary">Summary</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












